subsystem = NFIRAOS
component = ngsAdc

publish {
  events = [
    
    {
      name            = state
      description     = NGS ADC assembly state
      attributes      = [
        {
          name        = cmd
          description = NGS ADC assembly command state
          enum        = [ UNINITIALIZED, READY, BUSY, CONTINUOUS ]
        }
        {
          name        = move
          description = NGS ADC assembly movement state
          enum        = [ UNDATUMED, DATUMING, DATUMED, MOVING ]
        }
        {
          name        = onTarget
          description = Is current LGS trombone position within tolerance of the target position.
          type        = boolean
        }
      ]
    }

    {
      name            = imageShift
      description     = """The expected image shift of the NFIRAOS visible WFS position based on the current power and orientation of the NGS ADC.

If the current motor positions are not available (i.e. lost connection to galil or axis datum flag not set), then the expected image shift will stop being updated and hold constant at the previous value.

*Discussion: The visible ADC will shift an image position in a manner that depends upon the current state of the ADC. The estimated image shift is sent from the NFIRAOS CC to the TCS so that the TCS can adjust the visible WFS position demands accordingly.*"""
      maxRate         = 20
      archive         = true
      archiveRate     = 1
      attributes = [
        {
          name        = x 
          description = x-direction of image shift
          type        = double
          units       = "mm in FCRS<sub>174.5</sub> at reference wavelength"
        }
        {
          name        = y 
          description = y-direction of image shift
          type        = double
          units       = "mm in FCRS<sub>174.5</sub> at reference wavelength"

        }
      ]
    }
  
    {
      name            = pupilShift
      description     = """The expected PWFS pupil shift based on the current power and orientation of the NGS ADC.

If the current motor positions are not available (i.e. lost connection to galil or axis datum flag not set), then the expected pupil shift will stop being updated and hold constant at the previous value."""
      maxRate         = 20
      archive         = true
      archiveRate     = 1
      attributes = [
        {
          name        = x 
          description = x-direction of pupil shift
          type        = double
          units       = "fraction of pupil diameter shift in FCRS<sub>174.5</sub>"
        }
        {
          name        = y 
          description = y-direction of pupil shift
          type        = double
          units       = "fraction of pupil diameter shift in FCRS<sub>174.5</sub>"
        }
      ]
    }

    {
      name            = trackingError
      description     = """The tracking error is outside of the acceptable limits, while in follow mode (state.cmd == CONTINUOUS).

*Notable Event.*
"""
      maxRate         = 20
      archive         = true
      attributes      = [
        {
          name        = state
          description = "State of the Notable Event"
          type        = boolean
        }
        {
          name        = msg
          description = "Error message describing the Notable Event"
          type        = string
        }
      ]
    }

    {
      name            = target
      description     = Target position for the NGS ADC.
      attributes      = [
        {
          name        = power
          description = """Target ADC power.

In follow mode (state.cmd == CONTINUOUS) this target is updated based on TCS dispersion parameters. This value is also set by the datum and setAdc commands."""
          type        = double
          units       = TBD
        }
        {
          name        = orientation
          description = """Target ADC orientation.

In follow mode (state.cmd == CONTINUOUS) this target is updated based on TCS dispersion parameters. This value is also set by the  datum and setAdc commands."""
          type        = double
          units       = degrees
        }
        {
          name        = rotationA
          description = """Target position of the NGS ADC rotation A stage."""
          type        = double
          units       = degrees
        }
        {
          name        = rotationB
          description = """Target position of the NGS ADC rotation B stage."""
          type        = double
          units       = degrees
        }
      ]
    }

    {
      name            = current
      description     = """Current position of the NGS ADC."""
      maxRate         = 20
      attributes      = [
         {
          name        = datumA
          description = """Datum state of the NGS ADC rotation A stage."""
          type        = boolean
        }
        {
          name        = datumB
          description = """Datum state of the NGS ADC rotation B stage."""
          type        = boolean
        }
        {
          name        = rotationA
          description = """Current position of the NGS ADC rotation A stage."""
          type        = double
          units       = degrees
        }
        {
          name        = rotationB
          description = """Current position of the NGS ADC rotation B stage."""
          type        = double
          units       = degrees
        }
        {
          name        = errorA
          description = """Current NGS ADC rotation A stage tracking error (= target.rotationA-current.rotationA)"""
          type        = double
          units       = degrees
        }
        {
          name        = errorB
          description = """Current NGS ADC rotation B stage tracking error (= target.rotationB-current.rotationB)"""
          type        = double
          units       = degrees
        }    
      ]
    }
  ] 

  alarms = [
    {
      name = posErrA
      description = """The NGS ADC rotation A stage has an unacceptable position error, datum may be lost."""
      severity = major
      archive = true
    }
    {
      name = posErrB
      description = """The NGS ADC rotation B stage has an unacceptable position error, datum may be lost."""
      severity = major
      archive = true
    }
  ]

}
