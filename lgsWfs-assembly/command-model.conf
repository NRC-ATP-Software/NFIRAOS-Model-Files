subsystem = NFIRAOS
component = lgsWfs

description = LGS WFS Assembly commands.

receive = [
  
  {
    name            = init
    description     = """
    Request Command.

    Prepares the assembly for operation and reads configuration files. The configuration name must be specified if a configuration version is specified. This command will internally trigger a stop if required.

    If the configuration name is not specified, then a default configuration name and version is used. If the configuration version is not specified, then the default version is used for the specified configuration name.

    The configuration file will specify the following for all 6 LGS WFSs:
        * enable/disable LGS WFS
        * ip/port of LGS WFS cameras
        * ip/port destination for each LGS WFS pixel stream
        * other TBD quasi-static configuration parameters
<html>
  <p>
  Precondition:
  <ul>
  <li> state.cmd != busy
  </ul>

  <p>
  Execution:
  <ul>
  <li> state.cmd = busy
  </ul>

  <p>
  At Completion:
  <ul>
  <li> state.cmd = ready
  <li> state.wfs[disabled WFS] = disabled
  </ul>
</html>
    """
    args = [
      {
        name        = configuration name 
        description = Name of the configuration file to get from the TMT Configuration Service
        type        = string
      }
      {
        name        = configuration version
        description = Version of the configuration file to get from the TMT Configuration Service
        type        = string 
      }
    ]
  }

  {
    name            = datum
    description     = """
    Submit Command.

    Initializes all a specified LGS WFS. This command will internally trigger a stop if required.
<html>
  <p>
  Precondition:
  <ul>
  <li> state.cmd = ready | error
  </ul>

  <p>
  Execution:
  <ul>
  <li> state.cmd = busy
  </ul>

  <p>  
  At Completion:
  <ul>
  <li> state.cmd = ready
  <li> state.wfs[specified WFS] = initialized
  </ul>
</html>
    """
     args = [
      {
        name        = wfs 
        description = "specify which LGS WFS to initialize, 'all' only applies to enabled WFS"
        enum        = [ A, B, C, D, E, F, all ] 
      }
    ]

  }

  {
    name            = stop
    description     = """
    Request Command.

    Cancel the current submit type command and abort any current exposures on all LGS WFSs.
<html>
  <p>
  Precondition:
  <ul>
  <li> state.cmd != uninitialized
  </ul>
  
  <p>
  Execution:
  <ul>
  <li> state.cmd = busy
  </ul>

  <p>
  At Completion:
  <ul>
  <li> state.cmd = ready
  <li> state.wfs[enabled WFS] = initialized | idle
  </ul>
</html>
    """
  }

  {
    name            = configure
    description     = """
    Request Command.

    Command configures the specified LGS WFS.
<html>
  <p>
  Precondition:
  <ul>
  <li> state.cmd = ready | error
  <li> state.wfs[specified WFS] = initialized | idle 
  </ul>

  <p>
  Execution:
  <ul>
  <li> state.cmd = busy
  </ul>

  <p>  
  At Completion:
  <ul>
  <li> state.cmd = ready
  <li> state.wfs[specified WFS] = idle
  </ul>
</html>
    """
    args = [
       {
        name        = wfs 
        description = "specify which LGS WFS to configure, 'all' only applies to enabled WFS"
        enum        = [ A, B, C, D, E, F, all ] 
      }
      {
        name        = integration
        description = integration time
        type        = double
        units       = seconds
      }
      {
        name        = frame rate
        description = number of frames per second when in continuous mode
        type        = double
        units       = seconds
      }
    ]
  }


  {
    name            = mode
    description     = """
    Request Command.

    Set the readout mode of the specified LGS WFS.

    Setting the mode to idle will abort the any exposure in progress.
<html>
  <p>
  Precondition:
  <ul>
  <li> state.cmd = ready | error
  <li> state.wfs[specified WFS] = idle | continuous | single | triggered
  </ul>
 
  <p>
  Execution:
  <ul>
  <li> state.cmd = busy
  <li> if (mode == single) state.wfs[specified WFS] = single
  </ul>

  <p><p>
  
  At Completion:
  <ul>
  <li> state.cmd = ready
  <li> if (mode == continuous) state.wfs[specified WFS] = continuous
  <li> if (mode == triggered) state.wfs[specified WFS] = triggered
  <li> if (mode == idle | single) state.wfs[specified WFS] = idle
  </ul>
</html>
    """
    args = [
      {
        name        = wfs 
        description = "specify which LGS WFS to set the mode, 'all' only applies to enabled WFS"
        enum        = [ A, B, C, D, E, F, all ] 
      }
      {
        name        = mode
        description = desired readout mode
        enum        = [ idle, continuous, triggered, single ]
      }
    ]
  }

  {
    name            = read
    description     = """
    Submit Command.

    Engineering command to read a single frame from the specified LGS WFS.
<html>
  <p>
  Precondition:
  <ul>
  <li> state.cmd = ready | error
  <li> state.wfs[specified WFS] = idle
  </ul>
 
  <p>
  Execution:
  <ul>
  <li> state.cmd = busy
  <li> state.wfs[specified WFS] = single
  </ul>

  <p><p>
  
  At Completion:
  <ul>
  <li> state.cmd = ready
  <li> state.wfs[specified WFS] = idle
  </ul>
</html>
    """
    args = [
      {
        name        = wfs 
        description = "specify which LGS WFS to set the mode, 'all' only applies to enabled WFS"
        enum        = [ A, B, C, D, E, F, all ] 
      }
    ]
  }

]

