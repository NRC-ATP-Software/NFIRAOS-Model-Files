subsystem = NFIRAOS
component = nssNgs

description = NSS NGS Assembly commands.

receive = [
 
  {
    name            = init
    description     = """
Request Command.

Prepares the assembly for operation and reads configuration files. The configuration name must be specified if a configuration version is specified. This command will internally trigger a stop if required.

If the configuration name is not specified, then a default configuration name and version is used. If the configuration version is not specified, then the default version is used for the specified configuration name.
  
Precondition:
<ul>
<li> none
</ul>
Execution:
<ul>
<li> state.cmd = busy
<li> state.move = unindexed | indexed
</ul>
At Completion:
<ul>
<li> state.cmd = ready
</ul>
    """
    args = [
       {
        name        = configuration name 
        description = Name of the configuration file to get from the TMT Configuration Service
        type        = string
      }
      {
        name        = configuration version
        description = Version of the configuration file to get from the TMT Configuration Service
        type        = string 
      }
    ]
  }

{
    name            = datum
    description     = """
Submit Command.

Datum all the NSS NGS stages, including the FPM. This command will internally trigger a stop if required.
  
Precondition:
<ul>
<li> state.cmd != uninitialized
</ul>
Execution:
<ul>
<li> state.cmd = busy
<li> state.move = indexing
<li> state.source = false
</ul>
At Completion:
<ul>
<li> state.cmd = ready
<li> state.move = indexed
<li> state.deploy = extracted
<li> state.magnitude[7] = 0
</ul>
    """
  }

{
    name            = stop
    description     = """
Request Command.

Cancel the current submit type command, stop all NSS NGS stages and turn off the NGS simulation source.
  
Precondition:
<ul>
<li> state.cmd != uninitialized
</ul>
Execution:
<ul>
<li> state.cmd = busy
</ul>
At Completion:
<ul>
<li> state.cmd = ready
<li> state.move = unindexed | indexed
<li> state.intensityFixed = false
<li> state.deploy = extract | FPM | NGS | intermediate
</ul>
    """
  }


  {
    name            = move
    description     = """
Submit Command.

Engineering command that moves individual NSS NGS stages to the specified positions. This includes set motorized attenuators. The NGS simulation source stage and FPM-Y stage move along the same track and can interfere with one another. Therefore given the current and target positions of the NGS simulation source stage and FPM-Y stage, some combination are not allowed and will be reject.
  
Precondition:
<ul>
<li> state.cmd != uninitialized
<li> state.move = indexed | moving
</ul>
Execution:
<ul>
<li> state.cmd = busy
<li> state.move = moving
<li> state.deploy = intermediate
<li> if (NGS source stage target is specified)  state.source = false
</ul>
At Completion:
<ul>
<li> state.cmd = ready
<li> state.move = indexed
<li> state.deploy = extract | FPM | NGS | intermediate
<li> state.magnitude[7] = &lt; magnitude estimated base on input attenuation level &gt;
</ul>
    """
    args = [
      {
        name        = ngs
        description = target position of the NGS simulation source stage
        type        = double
        units       = mm
      }
      {
        name        = fpmY
        description = target absolute position of the FPM-Y stage
        type        = double
        units       = mm
      }
      {
        name        = fpmX
        description = target absolute position of the FPM-X stage
        type        = double
        units       = mm
      }
      {
        name        = attenuation
        description = target attenuation level for the variable NGS simulation sources
        type = array
        dimensions: [7]
        items = {
           type     = double
        }
        units       = dB (TBC)
      }
    ]
  }


 {
    name            = deploy
    description     = """
Submit Command.

Deploy the NGS simulation sources, deploy the FPM, or extract both.
  
Precondition:
<ul>
<li> state.cmd != uninitialized
<li> state.move = indexed | moving
</ul>
Execution:
<ul>
<li> state.cmd = busy
<li> state.move = moving
<li> state.deploy = intermediate
<li> if (selection != NGS ) state.source = false
</ul>
At Completion:
<ul>
<li> state.cmd = ready
<li> state.move = indexed
<li> state.deploy = extract | FPM | NGS
</ul>
    """
    args = [
      {
        name        = selection
        description = "choice of the NGS simulation sources, the FPM, or extract both"
        enum        = [ extract | FPM | NGS ] 
      }
    ]
  }

  {
    name            = source
    description     = """
Submit Command.

Turn off and on the NGS source and/or set the magnitude of the variable sources. The NGS simulation source stage must already be deployed. A LUT (TBC) is used to convert the desired magnitude into a attenuation level that will drive the motorized attenuators.
  
Precondition:
<ul>
<li> state.cmd = ready | error
<li> state.move = indexed
<li> state.deploy = NGS
</ul>
Execution:
<ul>
<li> state.cmd = busy
</ul>
At Completion:
<ul>
<li> state.cmd = ready
<li> state.source = &lt; input enable source &gt;
<li> state.magnitude[7] = &lt; input magnitude &gt; 
</ul>
    """
    args = [
      {
        name        = enable
        description = target power state of the NGS Tungsten-Halogen source
        type        = boolean
      }
      {
        name        = magnitude
        description = "target magnitude, in R band (TBC), of the variable NGS simulation sources"
        type = array
        dimensions: [7]
        items = {
           type     = double
        }
        units       = magnitude
      }
    ]
  }

  {
    name            = fpm
    description     = """
Submit Command.

Positions the FPM with respect to the FPM reference (deployed) position. The FPM must already be deployed.
  
Precondition:
<ul>
<li> state.cmd != uninitialized
<li> state.move = indexed
<li> state.deploy = FPM
</ul>
Execution:
<ul>
<li> state.cmd = busy
<li> state.move = moving
</ul>
At Completion:
<ul>
<li> state.cmd = ready
<li> state.move = indexed
</ul>
    """
    args = [
      {
        name        = x
        description = target relative position of the FPM in X
        type        = double
        units       = mm
      }
      {
        name        = y
        description = target relative position of the FPM in Y
        type        = double
        units       = mm
      }
    ]
  }


]

