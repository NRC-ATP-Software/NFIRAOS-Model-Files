subsystem = NFIRAOS
component = timing

description = Timing Assembly commands.

receive = [

  {
    name            = init
    description     = """Prepares the assembly for operation and reads configuration files.

This command will internally trigger a stop if required.

If configName and configVersion are not specified in the input, then the default configuration name and version will be used. If only configName is specified in the input, then the default version for the specified configName will be used. If only configVersion is specified in the input, then an error is returned.

*Simple Command.*
 
Precondition:
<ul>
<li> none
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
</ul>
At Completion:
<ul>
<li> state.cmd = READY
</ul>"""
    args = [
       {
        name        = configName 
        description = Name of the configuration file to get from the TMT Configuration Service
        type        = string
      }
      {
        name        = configVersion
        description = Version of the configuration file to get from the TMT Configuration Service
        type        = string 
      }
    ]
  }

  {
    name            = stop
    description     = """Stop all trigger signals.
  
*Simple Command.*

Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
</ul>
At Completion:
<ul>
<li> state.cmd = READY
<li> trigger.enable[] = false
</ul>"""
  }

  {
    name            = enableTrigger
    description     = """Start the specified trigger signal. 

The start time specifies the time at which the first trigger pulse will be generated. If the start time has already elapsed then the first trigger pulse will occur at the next possible multiple of the period from the start time.  

Channels 0 to 12 are allocated for instrument OIWFSs and ODGWs. It is up to the AOSQ to known which instruments detectors are physically connected to which NFIRAOS trigger channel 0 through 12 (TBD, it is possible the NCC can abstract this information through config files).

*Following Command.*

Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
</ul>
At Completion:
<ul>
<li> state.cmd = CONTINUOUS
<li> trigger.enable[{input channel}] = true
<li> trigger.period[{input channel}] = {input period}
<li> trigger.startTime[{input channel}] = {input startTime}
</ul>"""
    args = [
      {
        name        = channel
        description = """specific trigger signal to start
<ul>
<li> input channel set to LGSWFS mean all six LGS WFS trigger signals will be enabled with the same period and start time.
<li> input channel set to ALL mean all twenty trigger signals will be enabled with the same period and start time.
<li> input channel set to any other value means only the corresponding trigger signals will be enabled with the specified period and start time.
</ul>"""
        enum        = [ LGSWFS, LGSWFSA, LGSWFSB, LGSWFSC, LGSWFSD, LGSWFSE, LGSWFSF, PWFS,NGSFSM, CHANNEL0, CHANNEL1, CHANNEL2, CHANNEL3, CHANNEL4, CHANNEL5, CHANNEL6, CHANNEL7, CHANNEL8, CHANNEL9, CHANNEL10, CHANNEL11, ALL ]
      }
      {
          name        = period
          description = """period of the trigger pulses, must be divisible by 36.0625 (= <sup>10<sup>6</sup></sup>/<sub>(800Hz * 32)</sub>)."""
          type        = double
          minimum     = 36.0625
          units       = "microseconds"
      }
      {
          name        = startTime
          description = "time at which the first pulse of the trigger signal should occur"
          type        = double
          units       = "TAI / PTP"
      }
    ]
    requiredArgs = [ channel, period, startTime ]
  }

  {
    name            = disableTrigger
    description     = """Stop the specified trigger signal. 

The cmd state will remain CONTINUOUS if any trigger signal is still enabled after this command is complete. 

*Simple Command.*

Precondition:
<ul>
<li> state.cmd = CONTINUOUS
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
</ul>
At Completion:
<ul>
<li> state.cmd = READY | CONTINUOUS
<li> trigger.enable[{input channel}] = false
</ul>"""
    args = [
      {
        name        = channel
        description = """specific trigger signal to stop
<ul>
<li> input channel set to LGSWFS mean all six LGS WFS trigger signals will be disabled
<li> input channel set to ALL mean all twenty trigger signals will be disabled
<li> input channel set to any other value means only the corresponding trigger signals will be disabled
</ul>"""
        enum        = [ LGSWFS, LGSWFSA, LGSWFSB, LGSWFSC, LGSWFSD, LGSWFSE, LGSWFSF, PWFS, NGSFSM, CHANNEL0, CHANNEL1, CHANNEL2, CHANNEL3, CHANNEL4, CHANNEL5, CHANNEL6, CHANNEL7, CHANNEL8, CHANNEL9, CHANNEL10, CHANNEL11, ALL ]
      }
    ]
    requiredArgs = [ channel ]
  }

]

