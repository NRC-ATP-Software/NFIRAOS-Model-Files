subsystem = NFIRAOS
component = nsen

description = NSEN Assembly commands.

receive = [
 {
    name            = init
    description     = """Initialize the assembly and read configuration files.

This command will internally trigger a stop if required.

If configName and configVersion are not specified in the input, then the default configuration name and version will be used. If only configName is specified in the input, then the default version for the specified configName will be used. If only configVersion is specified in the input, then an error is returned.

*Simple Command.*

Precondition:
<ul>
<li> none
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
</ul>
At Completion:
<ul>
<li> state.cmd = READY
</ul>"""
    args = [
       {
        name        = configuration name
        description = Name of the configuration file to get from the TMT Configuration Service
        type        = string
      }
      {
        name        = configuration version
        description = Version of the configuration file to get from the TMT Configuration Service
        type        = string
      }
    ]

  }

  {
    name            = BENCH_datum
    description     = """Datum the NSEN optical bench stages.

This command will internally trigger a stop if required.

*Discrete Command.*

Precondition:
<ul>
<li> BENCH_state.cmd != UNINITIALIZED
</ul>
Execution:
<ul>
<li> BENCH_state.cmd = BUSY
<li> BENCH_state.move = true
</ul>
At Completion:
<ul>
<li> BENCH_state.cmd = READY
<li> BENCH_state.move = false
</ul>"""
  }

  {
    name            = BENCH_stop
    description     = """Cancel the current discrete type command and stops the NSEN optical bench stages.

*Discrete Command.*

Precondition:
<ul>
<li> BENCH_state.cmd != UNINITIALIZED
</ul>
Execution:
<ul>
<li> BENCH_state.cmd = BUSY
</ul>
At Completion:
<ul>
<li> BENCH_state.cmd = READY
<li> BENCH_state.move = false
</ul>"""
  }

  {
    name            = BENCH_move
    description     = """Engineering command to move the NSEN optical bench stages to the specified positions.

The NSEN optical bench stages must be datumed otherwise this command will be rejected.

*Discrete Command.*

Precondition:
<ul>
<li> BENCH_state.cmd != UNINITIALIZED
</ul>
Execution:
<ul>
<li> BENCH_state.cmd = BUSY
<li> BENCH_state.move = true
</ul>
At Completion:
<ul>
<li> BENCH_state.cmd = READY
<li> BENCH_state.move = false
</ul>"""
    args = [
      {
        name        = X
        description = target stage X position.
        type        = double
      }
      {
        name        = Y
        description = target stage Y position.
        type        = double
      }
      {
        name        = Z
        description = target stage Y position.
        type        = double
      }
    ]
  }

  {
    name            = BENCH_select
    description     = """Indicate which NSEN Camera is currently in use for the purposes of calculating optical bench positional offsets.

This command will not actually move the optical bench. Normally one would send the BENCH_offset command following BENCH_select for this purpose.

*Simple Command.*

Precondition:
<ul>
<li> BENCH_state.cmd != UNINITIALIZED
</ul>
At Completion:
<ul>
<li> BENCH_state.cmd = READY
<li> BENCH_state.select = ACQ | DL | HRWFS
</ul>"""
    args = [
      {
        name        = select
        description = which NSEN camera is used as a position reference for the optical bench
        enum        = [ ACQ, DL, HRWFS ]
      }
    ]
    requiredArgs = [ select ]
  }


  {
    name            = BENCH_offset
    description     = """Move the selected NSEN detector to the specified location.

The NSEN optical bench stages must be datumed otherwise this command will be rejected.

*Discrete Command.*

Precondition:
<ul>
<li> BENCH_state.cmd != UNINITIALIZED
</ul>
Execution:
<ul>
<li> BENCH_state.cmd = BUSY
<li> BENCH_state.move = true
</ul>
At Completion:
<ul>
<li> BENCH_state.cmd = READY
<li> BENCH_state.move = false
</ul>"""
    args = [
      {
        name        = dX
        description = target stage X offset of selected detector from origin.
        type        = double
      }
      {
        name        = dY
        description = target stage Y offset of selected detector from origin.
        type        = double
      }
      {
        name        = dZ
        description = target stage Z offset of selected detector from origin.
        type        = double
      }
    ]
  }


  {
    name            = ACQ_init
    description     = """Initialize the ACQ camera: (re-)load configuration files, (re-)connect to the camera

*Discrete Command.*

Precondition:
<ul>
</ul>
Execution:
<ul>
<li> ACQ_state.cmd = BUSY
</ul>
At Completion:
<ul>
<li> ACQ_state.cmd = READY
</ul>"""
  }

  {
    name            = ACQ_config
    description     = """Configure subsequent exposures ACQ camera

This command can be used to trigger one or multiple exposures. In the latter case, nexposures is set >1, and the period is set to the time between the start of each exposure. In this case, if the period is set to 0, it simply takes the nexposures as fast as possible. Otherwise positive values of exposure must be greater than the value of time.

*Discrete Command.*

Precondition:
<ul>
<li> ACQ_state.cmd != UNINITIALIZED
</ul>
Execution:
<ul>
<li> ACQ_state.cmd = BUSY
</ul>
At Completion:
<ul>
<li> ACQ_state.cmd = READY
</ul>"""
    args = [
      {
        name        = time
        description = exposure time
        type        = double
        units       = ms
      }
      {
        name        = nexposures
        description = number of exposures to take
        type        = integer
      }
      {
        name        = period
        description = time between triggers if performing multiple exposures
        type        = double
        units       = ms
      }
      {
        name        = bias
        description = name of bias image for calibration
        type        = string
      }
      {
        name        = dark
        description = name of dark image for calibration
        type        = string
      }
      {
        name        = flatfield
        description = name of flatfield image for calibration
        type        = string
      }
      {
        name        = path
        description = path to write images
        type        = string
      }
    ]
  }

  {
    name            = ACQ_expose
    description     = """Trigger one or more exposures as specified with the previous ACQ_config command.

*Discrete Command.*

Precondition:
<ul>
<li> ACQ_state.cmd != UNINITIALIZED
</ul>
Execution:
<ul>
<li> ACQ_state.cmd = BUSY
</ul>
At Completion:
<ul>
<li> ACQ_state.cmd = READY
</ul>"""
  }



  {
    name            = DL_init
    description     = """Initialize the DL camera: (re-)load configuration files, (re-)connect to the camera

*Discrete Command.*

Precondition:
<ul>
</ul>
Execution:
<ul>
<li> DL_state.cmd = BUSY
</ul>
At Completion:
<ul>
<li> DL_state.cmd = READY
</ul>"""
  }

  {
    name            = DL_config
    description     = """Configure subsequent exposures DL camera

This command can be used to trigger one or multiple exposures. In the latter case, nexposures is set >1, and the period is set to the time between the start of each exposure. In this case, if the period is set to 0, it simply takes the nexposures as fast as possible. Otherwise positive values of exposure must be greater than the value of time.

*Discrete Command.*

Precondition:
<ul>
<li> DL_state.cmd != UNINITIALIZED
</ul>
Execution:
<ul>
<li> DL_state.cmd = BUSY
</ul>
At Completion:
<ul>
<li> DL_state.cmd = READY
</ul>"""
    args = [
      {
        name        = time
        description = exposure time
        type        = double
        units       = ms
      }
      {
        name        = nexposures
        description = number of exposures to take
        type        = integer
      }
      {
        name        = period
        description = time between triggers if performing multiple exposures
        type        = double
        units       = ms
      }
      {
        name        = bias
        description = name of bias image for calibration
        type        = string
      }
      {
        name        = dark
        description = name of dark image for calibration
        type        = string
      }
      {
        name        = flatfield
        description = name of flatfield image for calibration
        type        = string
      }
      {
        name        = path
        description = path to write images
        type        = string
      }
    ]
  }

  {
    name            = DL_expose
    description     = """Trigger one or more exposures as specified with the previous DL_config command.

*Discrete Command.*

Precondition:
<ul>
<li> DL_state.cmd != UNINITIALIZED
</ul>
Execution:
<ul>
<li> DL_state.cmd = BUSY
</ul>
At Completion:
<ul>
<li> DL_state.cmd = READY
</ul>"""
  }

]
