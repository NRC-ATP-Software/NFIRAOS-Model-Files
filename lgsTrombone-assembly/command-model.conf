subsystem = NFIRAOS
component = lgsTrombone

description = LGS Trombone Assembly commands.

receive = [
  
{
    name            = init
    description     = """Immediate Command.

Prepares the assembly for operation and read configuration files. The configuration name must be specified if a configuration version is specified. This command will also the sodium layer estimate, and the clear SS flag. This command will internally trigger a stop if required.

If configName and configVersion are not specified in the input, then the default configuration name and version will be used. If only configName is specified in the input, then the default version for the specified configName will be used. If only configVersion is specified in the input, then an error is returned.

Precondition:
<ul>
<li> none
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
<li> state.move = UNDATUMED | DATUMED
</ul>
At Completion:
<ul>
<li> state.cmd = READY
<li> status.ss = false
<li> state.onTarget = true | false
<li> sodiumLayer.altitude = {default from config file}
<li> sodiumLayer.zenithAngle = {default from config file}
</ul>"""
    args = [
       {
        name        = configName 
        description = Name of the configuration file to get from the TMT Configuration Service
        type        = string
      }
      {
        name        = configVersion
        description = Version of the configuration file to get from the TMT Configuration Service
        type        = string 
      }
    ]

  }
  
  {
    name            = datum
    description     = """Submit Command.

Datum the LGS trombone stage. This command will internally trigger a stop if required. The final position of the LGS trombone stage will be set based on the current sodium layer altitude (sodiumLayer.altitude) and zenith angle (sodiumLayer.zenithAngle)

Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
<li> state.move = DATUMING
</ul>
At Completion:
<ul>
<li> state.cmd = READY
<li> state.move = DATUMED
<li> state.onTarget = true
</ul>"""
  }

  {
    name            = stop
    description     = """Immediate Command.

Cancel the current submit type command and stop the LGS trombone state stages.

Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
<li> status.ss = false
</ul>
At Completion:
<ul>
<li> state.cmd = READY
<li> state.move = UNDATUMED | DATUMED
<li> state.onTarget = true | false
</ul>"""
  }

  {
    name            = move
    description     = """Submit Command.

Engineering command that moves the LGS trombone stage to the specified  position.

Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
<li> state.move = DATUMED | MOVING
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
<li> state.move = MOVING
</ul>
At Completion:
<ul>
<li> state.cmd = READY
<li> state.move = DATUMED
<li> state.onTarget = true
</ul>"""
    args = [
      {
        name        = position
        description = target LGS trombone stage position.
        type        = double
        units       = mm
      }
    ]
    requiredArgs = [ position ]
  }

  {
    name            = sodiumLayer
    description     = """Submit Command.

Set the initial sodium layer altitude value, and move the LGS trombone to the corresponding position range distance, based on the specified zenith angle.

If the angle input parameter is not specified then current value stored in sodiumLayer.zenithAngle will be used to compute the range distance to initially position the trombone.

Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
<li> state.move = DATUMED | MOVING
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
<li> state.move = MOVING
<li> sodiumLayer.altitude = {input altitude}
<li> sodiumLayer.zenithAngle = {input zenithAngle}
</ul>
At Completion:
<ul>
<li> state.cmd = READY
<li> state.move = DATUMED
<li> state.onTarget = true
</ul>"""
    args = [
      {
        name        = altitude
        description = initial sodium layer altitude estimate.
        type        = double
        units       = km
      }
      {
        name        = zenithAngle
        description = initial zenith angle used to calculate range distance to position the trombone.
        type        = double
        minimum     = 1
        maximum     = 65
        units       = degrees
      }
    ]
    requiredArgs = [ altitude ]
  }

  {
    name            = follow
    description     = """Immediate Command.

Enable the LGS trombone follow mode. When the follow mode is enabled, the LGS trombone will track the focus errors from the NRTC, zenith angle from the TCS or SS LGS Assembly, and update the sodium layer altitude and range distance estimations. 

If SS mode is disabled, then the LGS trombone will follow the zenith angle stream from the TCS. If SS mode is enabled, then the LGS trombone will follow the zenith angle stream from the SS LGS Assembly. If the ss input parameter is not specified, then the SS mode (state.ss) will not be changed.
  
Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
<li> state.move = DATUMED | MOVING
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
</ul>
At Completion:
<ul>
<li> state.cmd = CONTINUOUS
<li> state.move = DATUMED | MOVING
<li> state.ss = {input ss}
<li> state.onTarget = true | false
<li> sodiumLayer.altitude = {updated based on RTC focus error}
<li> sodiumLayer.zenithAngle = {updated based on TCS or SS streams}
</ul>"""
  args = [
      {
        name        = ss
        description = enable SS mode to operate with SS LGS Assembly
        type        = boolean
      }
    ]
  }

]

