subsystem = NFIRAOS
component = lgsTrombone

description = LGS Trombone Assembly commands.

receive = [
  
{
    name            = init
    description     = """Request Command.

Prepares the assembly for operation and read configuration files. The configuration name must be specified if a configuration version is specified. This command will also the sodium layer estimate, and the clear NSS flag. This command will internally trigger a stop if required.

If configName and configVersion are not specified in the input, then the default configuration name and version will be used. If only configName is specified in the input, then the default version for the specified configName will be used. If only configVersion is specified in the input, then an error is returned.

Precondition:
<ul>
<li> none
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
<li> state.move = UNINDEXED | INDEXED
</ul>
At Completion:
<ul>
<li> state.cmd = READY
<li> state.sodiumLayer = false
<li> status.nss = false
</ul>"""
    args = [
       {
        name        = configName 
        description = Name of the configuration file to get from the TMT Configuration Service
        type        = string
      }
      {
        name        = configVersion
        description = Version of the configuration file to get from the TMT Configuration Service
        type        = string 
      }
    ]

  }
  
  {
    name            = datum
    description     = """Submit Command.

Datum the LGS trombone stage, clear sodium layer estimate, and the clear NSS flag. This command will internally trigger a stop if required.

Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
<li> state.move = INDEXING
</ul>
At Completion:
<ul>
<li> state.cmd = READY
<li> state.move = INDEXED
<li> state.sodiumLayer = false
<li> status.nss = false
</ul>"""
  }

  {
    name            = stop
    description     = """Request Command.

Cancel the current submit type command and stop the LGS trombone state stages.

Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
</ul>
At Completion:
<ul>
<li> state.cmd = READY
<li> state.move = UNINDEXED | INDEXED
</ul>"""
  }

  {
    name            = move
    description     = """Submit Command.

Engineering command that moves the LGS trombone stage to the specified  position.

Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
<li> state.move = INDEXED | MOVING
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
<li> state.move = MOVING
<li> state.sodiumLayer = false
</ul>
At Completion:
<ul>
<li> state.cmd = READY
<li> state.move = INDEXED
</ul>"""
    args = [
      {
        name        = position
        description = target LGS trombone stage position.
        type        = double
        units       = mm
      }
    ]
    requiredArgs = [ position ]
  }

  {
    name            = position
    description     = """Submit Command.

Engineering command that moves the LGS trombone stage to the specified  range distance.
  
Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
<li> state.move = INDEXED | MOVING
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
<li> state.move = MOVING
<li> state.sodiumLayer = false
</ul>
At Completion:
<ul>
<li> state.cmd = READY
<li> state.move = INDEXED
</ul>"""
    args = [
      {
        name        = rangeDistance
        description = target range distance.
        type        = double
        minimum     = 0
        units       = km
      }
    ]
    requiredArgs = [ rangeDistance ]
  }

  {
    name            = setElevation
    description     = """Submit Command.

Set the initial sodium layer elevation value, and move the LGS trombone to the corresponding position by executing the move command.

If the input angle parameter is not specified then the current/new point angle from the TCS is used.
  
Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
<li> state.move = INDEXED | MOVING
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
<li> state.move = MOVING
<li> state.sodiumLayer = false
</ul>
At Completion:
<ul>
<li> state.cmd = READY
<li> state.move = INDEXED
<li> state.sodiumLayer = true
</ul>"""
    args = [
      {
        name        = elevation
        description = initial sodium layer elevation estimate
        type        = double
        units       = km
      }
      {
        name        = angle
        description = initial zenith angle used to calculate range distance
        type        = double
        units       = degrees
      }
    ]
    requiredArgs = [ elevation ]
  }

 {
    name            = setAngle
    description     = """Submit Command.

Engineering command that sets the zenith angle used to position the trombone while the follow mode is not enabled. 

When in follow mode the LGS Trombone will track the zenith angle supplied by the TCS. However when not in follow mode, the effective range distance can be updated by this command based off the current sodium layer elevation value. 
  
Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
<li> state.move = INDEXED | MOVING
<li> state.sodiumLayer = true
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
<li> state.move = MOVING
</ul>
At Completion:
<ul>
<li> state.cmd = READY
<li> state.move = INDEXED
</ul>"""
    args = [
      {
        name        = angle
        description = zenith angle used to calculate range distance
        type        = double
        units       = degrees
      }
    ]
    requiredArgs = [ angle ]
  }

  {
    name            = follow
    description     = """Request Command.

Enable the LGS trombone follow mode. When the follow mode is enabled, the LGS trombone will track the focus errors from the NRTC, zenith angle from the TCS, and update the sodium layer elevation and range distance estimations. 

If NSS mode is enable, then the LGS trombone will not follow the zenith angle stream from the TCS and the internal set the zenith angle to zero. If the nss input parameter is not specified, then the NSS mode will be disabled.
  
Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
<li> state.move = INDEXED | MOVING
<li> state.sodiumLayer = true
</ul>
Execution:
<ul>
<li> none
</ul>
At Completion:
<ul>
<li> state.cmd = CONTINUOUS
<li> state.move = INDEXED | MOVING
<li> status.nss =  {input nss}
</ul>"""
  args = [
      {
        name        = nss
        description = enable NSS mode to operate with NSS LGS Assembly
        type        = boolean
      }
    ]
  }

]

