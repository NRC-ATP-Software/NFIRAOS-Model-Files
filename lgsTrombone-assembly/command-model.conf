subsystem = NFIRAOS
component = lgsTrombone

description = LGS Trombone Assembly commands.

receive = [
  
{
    name            = init
    description     = """Request Command.

Prepares the assembly for operation and read configuration files. The configuration name must be specified if a configuration version is specified. This command will also the sodium layer estimate, and the clear NSS flag. This command will internally trigger a stop if required.

If configName and configVersion are not specified in the input, then the default configuration name and version will be used. If only configName is specified in the input, then the default version for the specified configName will be used. If only configVersion is specified in the input, then an error is returned.

Precondition:
<ul>
<li> none
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
<li> state.move = UNINDEXED | INDEXED
<li> status.nss = false
</ul>
At Completion:
<ul>
<li> state.cmd = READY
<li> sodiumLayer.altitude = {default from config file}
<li> sodiumLayer.angle = {default from config file}
</ul>"""
    args = [
       {
        name        = configName 
        description = Name of the configuration file to get from the TMT Configuration Service
        type        = string
      }
      {
        name        = configVersion
        description = Version of the configuration file to get from the TMT Configuration Service
        type        = string 
      }
    ]

  }
  
  {
    name            = datum
    description     = """Submit Command.

Datum the LGS trombone stage, clear sodium layer estimate, and the clear NSS flag. This command will internally trigger a stop if required.

Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
<li> state.move = INDEXING
<li> status.nss = false
</ul>
At Completion:
<ul>
<li> state.cmd = READY
<li> state.move = INDEXED
</ul>"""
  }

  {
    name            = stop
    description     = """Request Command.

Cancel the current submit type command and stop the LGS trombone state stages.

Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
<li> status.nss = false
</ul>
At Completion:
<ul>
<li> state.cmd = READY
<li> state.move = UNINDEXED | INDEXED
</ul>"""
  }

  {
    name            = move
    description     = """Submit Command.

Engineering command that moves the LGS trombone stage to the specified  position.

Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
<li> state.move = INDEXED | MOVING
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
<li> state.move = MOVING
<li> status.nss = false
</ul>
At Completion:
<ul>
<li> state.cmd = READY
<li> state.move = INDEXED
</ul>"""
    args = [
      {
        name        = position
        description = target LGS trombone stage position.
        type        = double
        units       = mm
      }
    ]
    requiredArgs = [ position ]
  }

  {
    name            = sodiumLayer
    description     = """Submit Command.

Set the initial sodium layer altitude value, and move the LGS trombone to the corresponding position range distance, based on the specified zenith angle.

If the angle input parameter is not specified then the zenith angle from the TCS will be used to compute the range distance to initially position the trombone.

Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
<li> state.move = INDEXED | MOVING
</ul>
Execution:
<ul>
<li> state.cmd = BUSY
<li> state.move = MOVING
<li> status.nss = false
</ul>
At Completion:
<ul>
<li> state.cmd = READY
<li> state.move = INDEXED
</ul>"""
    args = [
      {
        name        = altitude
        description = initial sodium layer altitude estimate.
        type        = double
        units       = km
      }
      {
        name        = angle
        description = initial zenith angle used to calculate range distance to position the trombone.
        type        = double
        minimum     = 1
        maximum     = 65
        units       = degrees
      }
    ]
    requiredArgs = [ altitude ]
  }

  {
    name            = follow
    description     = """Request Command.

Enable the LGS trombone follow mode. When the follow mode is enabled, the LGS trombone will track the focus errors from the NRTC, zenith angle from the TCS or NSS LGS Assembly, and update the sodium layer altitude and range distance estimations. 

If NSS mode is disabled, then the LGS trombone will follow the zenith angle stream from the TCS. If NSS mode is enabled, then the LGS trombone will follow the zenith angle stream from the NSS LGS Assembly. If the nss input parameter is not specified, then the NSS mode will be disabled.
  
Precondition:
<ul>
<li> state.cmd != UNINITIALIZED
<li> state.move = INDEXED | MOVING
</ul>
Execution:
<ul>
<li> none
</ul>
At Completion:
<ul>
<li> state.cmd = CONTINUOUS
<li> state.move = INDEXED | MOVING
<li> status.nss =  {input nss}
</ul>"""
  args = [
      {
        name        = nss
        description = enable NSS mode to operate with NSS LGS Assembly
        type        = boolean
      }
    ]
  }

]

