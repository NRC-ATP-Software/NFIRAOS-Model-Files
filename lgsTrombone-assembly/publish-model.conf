subsystem = NFIRAOS
component = lgsTrombone

publish {
  events = [
    {
      name            = state
      description     = LGS trombone assembly state
      attributes      = [
        {
          name        = cmd
          description = LGS trombone assembly command state
          enum        = [ UNINITIALIZED, READY, BUSY, CONTINUOUS ]
        }
        {
          name        = move
          description = LGS trombone assembly movement state
          type        = boolean 
        }
        {
          name        = ss 
          description = flag indicating if SS mode is enabled
          type        = boolean
        }
        {
          name        = onTarget
          description = Current LGS trombone position within tolerance of the target position.
          type        = boolean
        }
      ]
    }

    {
      name            = sodiumLayer
      description     = """Estimate of the current sodium layer parameters.

While in follow mode (state.cmd == CONTINUOUS) this item will be published at a period of 0.3 seconds for the AOESW. This item will also be published whenever the init or sodiumLayer command is completed."""
      maxRate         = 3.33
      archive         = true
      archiveRate     = 3.33
      attributes = [
         {
          name        = zenithAngle
          description = """Current zenith angle used to calculate range distance from altitude. 

In follow mode (state.cmd == CONTINUOUS), if the SS is not being used (status.ss == false) then this angle is updated based on the zenith angle stream from the TCS. If the SS is being used (status.ss == true) then this angle is updated based on the zenith angle stream from the SS LGS Assembly. This value is also set by the init and sodiumLayer commands."""
          type        = double
          minimum     = 1
          maximum     = 65
          units       = degrees
        }
        {
          name        = altitude 
          description = """Current best estimate of the sodium layer altitude.

In follow mode (state.cmd == CONTINUOUS) this estimate is updated based on focus error measurements from the RTC. This value is also set by the init and sodiumLayer commands."""
          type        = double
          minimum     = 0
          units       = km
        }
      ]
    }

    {
      name            = trackingError
      description     = """The tracking error is outside of the acceptable limits, while in follow mode (state.cmd == CONTINUOUS).

*Notable Event.*
"""
      maxRate         = 20
      archive         = true
      attributes      = [
        {
          name        = state
          description = "State of the Notable Event"
          type        = boolean
        }
        {
          name        = msg
          description = "Error message describing the Notable Event"
          type        = string
        }
      ]
    }

  ]

  telemetry = [
    {
      name            = target
      description     = """Target position for the LGS trombone.""" 
      attributes      = [
         {
          name        = rangeDistance
          description = "Target sodium layer range distance based on altitude estimate and zenith angle (= sodiumLayer.altitude/cos(sodiumLayer.angle))."
          type        = double
          minimum     = 0
          units       = km
        }
        {
          name        = stage
          description = """Target position of the LGS trombone stage."""
          type        = double
          units       = mm
        }
      ]
    }
    {
      name            = current
      description     = """Current position of LGS trombone."""
      maxRate         = 20
      attributes      = [
        {
          name        = datum
          description = """Datum state of the LGS trombone stage."""
          type        = boolean
        }
        {
          name        = rangeDistance
          description = """Current range distance based on the LGS trombone stage position."""
          type        = double
          units       = km
        }
        {
          name        = error
          description = """Current range distance tracking error (= positionTarget.rangeDistance - positionCurrent.positionRangeDistance)."""
          type        = double
          units       = km
        }
        {
          name        = stage
          description = """Current position of the LGS trombone stage."""
          type        = double
          units       = mm
        }
      ]
    }
    
  ] 
  
  alarms = [
    {
      name = limit
      description = The LGS trombone stage has reached a limit
      severity = major
      archive = true
    }
    {
      name = posErr
      description = The LGS trombone stage has an unacceptable position error, datum may be lost.
      severity = major
      archive = true
    }
  ]

}
