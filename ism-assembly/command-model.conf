subsystem = NFIRAOS
component = ism

description = ISM Assembly commands.

receive = [
 {
    name            = init
    description     = """
    Request Command.

    Initialize the assembly and read configuration files. The configuration name must be specified if a configuration version is specified. This command will internally trigger a stop if required.

    If the configuration name is not specified, then a default configuration name and version is used. If the configuration version is not specified, then the default version is used for the specified configuration name.
<html>
  <p>
  Precondition:
  <ul>
  <li> none
  </ul>

  <p>
  Execution:
  <ul>
  <li> state.cmd = busy
  <li> state.move = unindexed | indexed
  </ul>

  <p>
  At Completion:
  <ul>
  <li> state.cmd = ready
  </ul>
</html>
    """
    args = [
       {
        name        = configuration name 
        description = Name of the configuration file to get from the TMT Configuration Service
        type        = string
      }
      {
        name        = configuration version
        description = Version of the configuration file to get from the TMT Configuration Service
        type        = string 
      }
    ]

  }

{
    name            = datum
    description     = """
    Submit Command.

    Datum the ISM stage and prepares. This command will internally trigger a stop if required.
<html>
  <p>
  Precondition:
  <ul>
  <li> state.cmd != uninitialized
  </ul>

  <p>
  Execution:
  <ul>
  <li> state.cmd = busy
  <li> state.move = indexing
  </ul>

  <p>  
  At Completion:
  <ul>
  <li> state.cmd = ready
  <li> state.move = indexed
  <li> state.selection = side
  </ul>
</html>
    """
  }

  {
    name            = stop
    description     = """
    Request Command.

    Cancel the current submit type command and stop the ISM stage.
<html>
  <p>
  Precondition:
  <ul>
  <li> state.cmd != uninitialized
  </ul>
  
  <p>
  Execution:
  <ul>
  <li> state.cmd = busy
  </ul>

  <p>
  At Completion:
  <ul>
  <li> state.cmd = ready
  <li> state.move = unindexed | indexed
  </ul>
</html>
    """
  }

 {
    name            = move
    description     = """
    Submit Command.

    Engineering command to move the ISM stage to the specified position.
<html>
  <p>
  Precondition:
  <ul>
  <li> state.cmd != uninitialized
  <li> state.move = indexed | moving
  </ul>
  
  <p>
  Execution:
  <ul>
  <li> state.cmd = busy
  <li> state.move = moving
  <li> state.selection = intermediate 
  </ul>

  <p>
  At Completion:
  <ul>
  <li> state.cmd = ready
  <li> state.move = indexed
  <li> state.selection = bottom | side | top | eng_bottom | eng_side | eng_top | intermediate
</html>
    """
    args = [
      {
        name        = position
        description = target ISM stage position.
        type        = double
        units       = degrees
      }
    ]
  }


  {
    name            = select
    description     = """
    Submit Command.

    Position the ISM to direct light to the NFIRAOS bottom, side or top port or to one of the engineering bottom, side, or top positions.
<html>
  <p>
  Precondition:
  <ul>
  <li> state.cmd != uninitialized
  <li> state.move = indexed | moving
  </ul>
  
  <p>
  Execution:
  <ul>
  <li> state.cmd = busy
  <li> state.move = moving
  <li> state.selection = intermediate 
  </ul>

  <p>  
  At Completion:
  <ul>
  <li> state.cmd = ready
  <li> state.move = indexed
  <li> state.selection = bottom | side | top | eng_bottom | eng_side | eng_top
</html>
    """
    args = [
      {
        name        = selection
        description = "Choice of either bottom, side or top port positions or one of the engineering bottom, side, or top positions.  Each top, side, and bottom 'positions' correspond to the equivalent top, side, and bottom port gates."
        enum        = [ bottom, side, top, eng_bottom, eng_side, eng_top ] 
      }
    ]
  }

]

